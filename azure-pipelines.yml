# azure-cosmos-cassandra-driver-4-extensions build pipeline
# Builds and runs tests with Apache Maven.
# Reference: https://docs.microsoft.com/azure/devops/pipelines/languages/java

trigger:
- develop/java-driver-4
- release/java-driver-4/*

pr:
- develop/java-driver-4
- release/java-driver-4/*

variables:

- name: Azure.Cosmos.Cassandra.Preferred.Regions
  value: '$(AZURE_COSMOS_CASSANDRA_PREFERRED_REGION_1),$(AZURE_COSMOS_CASSANDRA_PREFERRED_REGION_2),$(AZURE_COSMOS_CASSANDRA_PREFERRED_REGION_3)'
  readonly: true

- name: Azure.Cosmos.Cassandra.Regional.Endpoints
  value: '$(AZURE_COSMOS_CASSANDRA_REGIONAL_ENDPOINT_1),$(AZURE_COSMOS_CASSANDRA_REGIONAL_ENDPOINT_2),$(AZURE_COSMOS_CASSANDRA_REGIONAL_ENDPOINT_3)'

- name: Azure.Cosmos.Cassandra.Truststore.Content
  value: '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'
  readonly: true

- name: Azure.Cosmos.Cassandra.Truststore.Path
  value: $(Build.Repository.LocalPath)/truststore.p12
  readonly: true

- name: Azure.Cosmos.Cassandra.Log.File
  value: $(Build.ArtifactStagingDirectory)/azure-cosmos-cassandra-driver-4.log
  readonly: true

- name: Azure.Cosmos.Cassandra.Reporting.Directory
  value: $(Build.ArtifactStagingDirectory)
  readonly: true

- name: New-JavaTruststore
  value: |
    Set-Content -Path "${env:AZURE_COSMOS_CASSANDRA_TRUSTSTORE_PATH}" -AsByteStream -Value ([System.Convert]::FromBase64String("${env:AZURE_COSMOS_CASSANDRA_TRUSTSTORE_CONTENT}"))
    "Keystore path: ${env:AZURE_COSMOS_CASSANDRA_TRUSTSTORE_PATH}"
    keytool -list -keystore "${env:AZURE_COSMOS_CASSANDRA_TRUSTSTORE_PATH}" -storepass "${env:AZURE_COSMOS_CASSANDRA_TRUSTSTORE_PASSWORD}"

- name: Stage-Artifacts
  value: |
    $packageName = [System.IO.Path]::GetFileNameWithoutExtension($(Get-Item *.jar -Exclude *-sources.jar,*-javadoc.jar).Name)
    $targetDirectory = New-Item -ItemType Directory (Join-Path $Env:BUILD_ARTIFACTSTAGINGDIRECTORY ${packageName})

    Copy-Item *.jar $targetDirectory
    Copy-Item (Join-Path .. pom.xml) (Join-Path ${targetDirectory} ${packageName}.pom)

    $packageName = $packageName.Split("-extensions-") -join "-"
    $targetDirectory = New-Item -ItemType Directory (Join-Path $Env:BUILD_ARTIFACTSTAGINGDIRECTORY ${packageName})

    Copy-Item (Join-Path .. .. pom.xml) (Join-Path ${targetDirectory} ${packageName}.pom)
  readonly: true

- name: Update-GithubSubmodules
  value: |
    git submodule update --init --recursive
  readonly: true

jobs:

- job: Build_with_Java_8
  strategy:
    matrix:
      Linux:
        ImageName: 'ubuntu-latest'
      MacOS:
        ImageName: 'macos-latest'
      Windows:
        ImageName: 'windows-latest'
    maxParallel: 1
  pool:
    vmImage: $(ImageName)
  steps:
  - task: PowerShell@2
    displayName: Update GitHub Submodules
    inputs:
      targetType: inline
      script: $(Update-GithubSubmodules)
      pwsh: true
      workingDirectory: $(Build.Repository.LocalPath)
  - task: Maven@3
    displayName: 'Build'
    inputs:
      mavenPomFile: 'pom.xml'
      javaHomeOption: 'JDKVersion'
      jdkVersionOption: '1.8'
      jdkArchitectureOption: 'x64'
      mavenOptions: '-Xmx3072m'
      goals: 'install'
      options: '-DskipTests'
  - task: PowerShell@2
    displayName: 'Create Java truststore'
    inputs:
      targetType: 'inline'
      script: $(New-JavaTruststore)
      pwsh: true
      workingDirectory: '$(Build.ArtifactStagingDirectory)'
    env:
      AZURE_COSMOS_CASSANDRA_TRUSTSTORE_PASSWORD: $(AZURE_COSMOS_CASSANDRA_TRUSTSTORE_PASSWORD)
  - task: Maven@3
    displayName: 'Verify driver-4 extensions'
    inputs:
      mavenPomFile: 'driver-4/pom.xml'
      javaHomeOption: 'JDKVersion'
      jdkVersionOption: '1.8'
      jdkArchitectureOption: 'x64'
      mavenOptions: '-Xmx3072m'
      goals: 'verify'
      options: -Dcheckstyle.skip -Dmaven.main.skip -DargLine="-Djavax.net.ssl.trustStoreType=PKCS12"
      testResultsFiles: '**/surefire-reports/TEST-*.xml'
      publishJUnitResults: true
    env:
      AZURE_COSMOS_CASSANDRA_PASSWORD: $(AZURE_COSMOS_CASSANDRA_PASSWORD)
      AZURE_COSMOS_CASSANDRA_TRUSTSTORE_PASSWORD: $(AZURE_COSMOS_CASSANDRA_TRUSTSTORE_PASSWORD)
  - task: Maven@3
    displayName: 'Verify java-driver-app example'
    inputs:
      mavenPomFile: 'examples/java-driver-app/pom.xml'
      mavenOptions: '-Xmx3072m'
      javaHomeOption: 'JDKVersion'
      jdkVersionOption: '1.8'
      jdkArchitectureOption: 'x64'
      goals: 'verify'
      options: "-Dcheckstyle.skip -Dmaven.main.skip -DargLine=\"-Dazure.cosmos.cassandra.jar='${project.build.directory}/${project.build.finalName}.jar' -Dazure.cosmos.cassandra.log-path='${project.basedir}'\""
      testResultsFiles: '**/surefire-reports/TEST-*.xml'
      publishJUnitResults: true
    env:
      AZURE_COSMOS_CASSANDRA_JAVA_OPTIONS: $(AZURE_COSMOS_CASSANDRA_JAVA_OPTIONS)
      AZURE_COSMOS_CASSANDRA_PASSWORD: $(AZURE_COSMOS_CASSANDRA_PASSWORD)
      AZURE_COSMOS_CASSANDRA_TRUSTSTORE_PASSWORD: $(AZURE_COSMOS_CASSANDRA_TRUSTSTORE_PASSWORD)
  - task: Maven@3
    displayName: 'Verify spring-boot-app example'
    inputs:
      mavenPomFile: 'examples/spring-boot-app/pom.xml'
      mavenOptions: '-Xmx3072m'
      javaHomeOption: 'JDKVersion'
      jdkVersionOption: '1.8'
      jdkArchitectureOption: 'x64'
      goals: 'verify'
      options: "-Dcheckstyle.skip -Dmaven.main.skip -DargLine=\"-Dazure.cosmos.cassandra.jar='${project.build.directory}/${project.build.finalName}.jar' -Dazure.cosmos.cassandra.log-path='${project.basedir}'\""
      testResultsFiles: '**/surefire-reports/TEST-*.xml'
      publishJUnitResults: true
    env:
      AZURE_COSMOS_CASSANDRA_PASSWORD: $(AZURE_COSMOS_CASSANDRA_PASSWORD)
      AZURE_COSMOS_CASSANDRA_TRUSTSTORE_PASSWORD: $(AZURE_COSMOS_CASSANDRA_TRUSTSTORE_PASSWORD)
  - task: PowerShell@2
    displayName: 'Stage driver-4 artifacts'
    inputs:
      targetType: 'inline'
      script: $(Stage-Artifacts)
      pwsh: true
      workingDirectory: '$(Build.Repository.LocalPath)/driver-4/target'
  - task: PowerShell@2
    displayName: 'Stage spring-data artifacts'
    inputs:
      targetType: 'inline'
      script: $(Stage-Artifacts)
      pwsh: true
      workingDirectory: '$(Build.Repository.LocalPath)/spring-data/target'
  - task: PublishPipelineArtifact@1
    displayName: 'Publish staged artifacts'
    inputs:
      targetPath: '$(Build.ArtifactStagingDirectory)'
      artifact: 'driver-4.java-8.$(ImageName)'
      publishLocation: 'pipeline'

- job: Build_with_Java_11
  strategy:
    matrix:
      Linux:
        ImageName: 'ubuntu-latest'
      MacOS:
        ImageName: 'macos-latest'
      Windows:
        ImageName: 'windows-latest'
    maxParallel: 1
  pool:
    vmImage: $(ImageName)
  steps:
  - task: PowerShell@2
    displayName: Update GitHub Submodules
    inputs:
      targetType: inline
      script: $(Update-GithubSubmodules)
      pwsh: true
      workingDirectory: $(Build.Repository.LocalPath)
  - task: Maven@3
    displayName: 'Build'
    inputs:
      mavenPomFile: 'pom.xml'
      javaHomeOption: 'JDKVersion'
      jdkVersionOption: '1.11'
      jdkArchitectureOption: 'x64'
      mavenOptions: '-Xmx3072m'
      goals: 'install'
      options: '-DskipTests'
  - task: PowerShell@2
    displayName: 'Create Java truststore'
    inputs:
      targetType: 'inline'
      script: $(New-JavaTruststore)
      pwsh: true
      workingDirectory: '$(Build.ArtifactStagingDirectory)'
    env:
      AZURE_COSMOS_CASSANDRA_TRUSTSTORE_PASSWORD: $(AZURE_COSMOS_CASSANDRA_TRUSTSTORE_PASSWORD)
  - task: Maven@3
    displayName: 'Verify driver-4 extensions'
    inputs:
      mavenPomFile: 'driver-4/pom.xml'
      javaHomeOption: 'JDKVersion'
      jdkVersionOption: '1.11'
      jdkArchitectureOption: 'x64'
      mavenOptions: '-Xmx3072m'
      goals: 'verify'
      options: -Dcheckstyle.skip -Dmaven.main.skip
      testResultsFiles: '**/surefire-reports/TEST-*.xml'
      publishJUnitResults: true
    env:
      AZURE_COSMOS_CASSANDRA_JAVA_OPTIONS: $(AZURE_COSMOS_CASSANDRA_JAVA_OPTIONS)
      AZURE_COSMOS_CASSANDRA_PASSWORD: $(AZURE_COSMOS_CASSANDRA_PASSWORD)
      AZURE_COSMOS_CASSANDRA_TRUSTSTORE_PASSWORD: $(AZURE_COSMOS_CASSANDRA_TRUSTSTORE_PASSWORD)
  - task: Maven@3
    displayName: 'Verify java-driver-app example'
    inputs:
      mavenPomFile: 'examples/java-driver-app/pom.xml'
      mavenOptions: '-Xmx3072m'
      javaHomeOption: 'JDKVersion'
      jdkVersionOption: '1.8'
      jdkArchitectureOption: 'x64'
      goals: 'verify'
      options: "-Dcheckstyle.skip -Dmaven.main.skip -DargLine=\"-Dazure.cosmos.cassandra.jar='${project.build.directory}/${project.build.finalName}.jar' -Dazure.cosmos.cassandra.log-path='${project.basedir}'\""
      testResultsFiles: '**/surefire-reports/TEST-*.xml'
      publishJUnitResults: true
    env:
      AZURE_COSMOS_CASSANDRA_PASSWORD: $(AZURE_COSMOS_CASSANDRA_PASSWORD)
      AZURE_COSMOS_CASSANDRA_TRUSTSTORE_PASSWORD: $(AZURE_COSMOS_CASSANDRA_TRUSTSTORE_PASSWORD)
  - task: Maven@3
    displayName: 'Verify spring-boot-app example'
    inputs:
      mavenPomFile: 'examples/spring-boot-app/pom.xml'
      mavenOptions: '-Xmx3072m'
      javaHomeOption: 'JDKVersion'
      jdkVersionOption: '1.11'
      jdkArchitectureOption: 'x64'
      goals: 'verify'
      options: "-Dcheckstyle.skip -Dmaven.main.skip -DargLine=\"-Dazure.cosmos.cassandra.jar='${project.build.directory}/${project.build.finalName}.jar' -Dazure.cosmos.cassandra.log-path='${project.basedir}'\""
      testResultsFiles: '**/surefire-reports/TEST-*.xml'
      publishJUnitResults: true
    env:
      AZURE_COSMOS_CASSANDRA_PASSWORD: $(AZURE_COSMOS_CASSANDRA_PASSWORD)
      AZURE_COSMOS_CASSANDRA_TRUSTSTORE_PASSWORD: $(AZURE_COSMOS_CASSANDRA_TRUSTSTORE_PASSWORD)
  - task: PowerShell@2
    displayName: 'Stage driver-4 artifacts'
    inputs:
      targetType: 'inline'
      script: $(Stage-Artifacts)
      pwsh: true
      workingDirectory: '$(Build.Repository.LocalPath)/driver-4/target'
  - task: PowerShell@2
    displayName: 'Stage spring-data artifacts'
    inputs:
      targetType: 'inline'
      script: $(Stage-Artifacts)
      pwsh: true
      workingDirectory: '$(Build.Repository.LocalPath)/spring-data/target'
  - task: PublishPipelineArtifact@1
    displayName: 'Publish staged artifacts'
    inputs:
      targetPath: '$(Build.ArtifactStagingDirectory)'
      artifact: 'driver-4.java-11.$(ImageName)'
      publishLocation: 'pipeline'
